<!DOCTYPE html>
<html lang="en">
<head>
  
  {{> head }}
  
  <title>Amrita Trees: Repository</title>
  <link rel="stylesheet" href="./css/style.css">
<!--   <link rel="stylesheet" href="./css/map.css"> -->
  
  <script src="./js/app.js" defer></script>
<!--   <script src="./js/map.js" defer></script> -->
  
<style>

#mapContainer{
  height:100%;
  overflow:hidden;
}
  
#map{
  height:calc(100% + 23px);
}  

  
.gm-style-iw-d{
  color:black;    
}
</style>

<style>
#treetable{
  
  --textSize: 1.3rem;
  --heightMultiplier: 5;
  
  --gap: 10px;
  width:min(350px,calc(100% - var(--gap) - var(--gap)));
  height:calc( var(--textSize) * var(--heightMultiplier) );
  background-color:gray;
/*   border: 3px solid red; */
  overflow:auto;
  
  position:absolute;
  left:var(--gap);
  bottom:calc( 3 * var(--gap) );
  
  border-radius:15px;
}

#treetable .table{
  --margin: .5rem;
  display:flex;
  flex-direction:column;
  
  height:100%;
  overflow-y:scroll;
  
  scroll-snap-type: y mandatory;
  padding-top: calc( 2 * var(--textSize));
  padding-bottom: calc( 2 * var(--textSize));
  padding-left: 2rem;
  position:relative;
}
  
#treetable:after{
  --borderThickness: 4px;
  content:"";
  position:absolute;
  top:50%;
  left:calc(-1rem - var(--borderThickness));
  transform:translate(0,-50%) rotate(45deg) scale(.75);
  
  background-image:linear-gradient(45deg, green, yellowgreen);
  border: var(--borderThickness) solid black;
  width:2rem;
  height:2rem;
}
  
#treetable .table::-webkit-scrollbar {width: 3px;}
#treetable .table::-webkit-scrollbar-track {background: transparent;}
#treetable .table::-webkit-scrollbar-thumb {background: white;}
  
#treetable .table div{
  --outlineWidth: 90%;
  scroll-snap-align: center;
/*   height: 2.5rem; */
  margin-top: var(--margin);
  margin-bottom: var(--margin);
  
  color:white;
  
  font-size: calc( var(--textSize) + .4rem );
  display: flex;
  align-items: center;
/*   justify-content: center; */
  
  position:relative;
  padding-left:20px;
  
}
#treetable .table div.active:after{
  
  content:"";
  position:absolute;left:0;top:50%;
  transform:translateY(-50%);
  height:100%;
  width: var(--outlineWidth);
  border:3px solid white;
  border-radius:25px;
}
  
#treetable .table div span{
  position:absolute;
  right:calc( 100% - var( --outlineWidth) - 3px);
  top:0;
  height:100%;
  width:calc( var(--textSize) * 1.5);
  display:none;
  background-color:blue;
  border-radius:50%;
}
  
#treetable .table div.active span{
  display:block;    
}
  
</style>
  
</head>
<body id="body">
  <div id="container">
    
    <div id="overlay" onclick="clickedOverlay()"></div>        

    <div id="mapContainer">
      <div id="map"></div>
    </div>


    
    <div id="treetable">
      <div class="table" onwheel="onWheel(event)">
        
        <div>aaa</div>
        <div>bbb</div>
        <div>ccc</div>
        <div>ddd</div>
        <div>eee</div>
        <div>fff</div>

        <div>aaa</div>
        <div>bbb</div>
        <div>ccc</div>
        <div>ddd</div>
        <div>eee</div>
        <div>fff</div>

        <div>aaa</div>
        <div>bbb</div>
        <div>ccc</div>
        <div>ddd</div>
        <div>eee</div>
        <div>fff</div>

      </div>
    </div>

  </div>
</body>
  
<script>
function $(x){return document.querySelector(x);}
  
document.querySelectorAll(".table > div").forEach(ele => {
  console.log(ele);
  ele.classList.add("noSelect");
  const search = document.createElement("span");
  
  ele.appendChild(search)
  ele.addEventListener("click", ()=>{
    ele.scrollIntoView();
    if($(".table").lastElementChild != ele)$(".table").scrollBy({left:0,top:-16});
    
    if( $(".table div.active") ) $(".table div.active").classList.remove("active");
    ele.classList.add("active");
    
  });
  
})
  
function onWheel(e){
//   console.log(e);
  
//   let d = e.deltaY;
//   while(d > 0){
//     $(".table").scrollBy({left:0,top:32, behavior:"smooth"});
//     d -= 125;
//   }
//   while(d < 0){
//     $(".table").scrollBy({left:0,top:-32, behavior:"smooth"});
//     d += 125;
//   }
  
  if(e.deltaY > 0){
    // down
    // console.log("down");
    $(".table").scrollBy({left:0,top:32, behavior:"smooth"});
  } else {
    // up
    // console.log("up");
    $(".table").scrollBy({left:0,top:-32, behavior:"smooth"});
  }
  e.preventDefault();
}
  
  
</script>
  
<script>
async function initMap() {
  
  let map = new google.maps.Map(document.getElementById("map"),
    {
      center: { lat: 10.900016808568687, lng: 76.9028589289025 },
      zoom: 20,
      mapId: "661dd2cc98d8e9e2",
      mapTypeId: 'satellite',
    }
  );
  
  map.setOptions({
    // draggable: false, 
    zoomControl: false, 
    // scrollwheel: false, 
    disableDoubleClickZoom: true,
    disableDefaultUI: true,
  });
  
//   fetch("https://amritatrees.glitch.me/trees")
//   .then( data => data.json() )
//   .then( data => {
//     data.forEach( tree => {
//     // ###########################################################################
//       const lat = Number(tree.coords.split(",")[0]);
//       const lng = Number(tree.coords.split(",")[1]);
      
//       const iconSize = 80;
//       let tree_icon = tree.icon || tree_icon_url;
//       const marker = new google.maps.Marker({
//         title: tree.title,
//         position: {lat: lat, lng: lng },
//         map,
//         icon: {
//           url: tree_icon,
//           scaledSize: new google.maps.Size(iconSize, iconSize),
//           origin: new google.maps.Point(0, 0),
//           anchor: new google.maps.Point(iconSize/2, iconSize/2),
//         },
//       })
      
//       const infowindow = new google.maps.InfoWindow({content: tree.title});
//       marker.addListener("click", () => {
//         if (infowindow) {infowindow.close();}
//         infowindow.open({anchor: marker,map,shouldFocus: false,});
//       });
      
//       marker.setMap(map);
      
//     // ########################################################################### 
//     })
//   });
  
  
  
  
  const loop = () => {
    if(navigator.geolocation){navigator.geolocation.getCurrentPosition( (position)=>{
      const pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude,
      };
      map.setCenter(pos);
      const latlng = new google.maps.LatLng(pos.lat, pos.lng);
      currPosMarker.setPosition(latlng);
    });
    }
  }
  
  

  // resize markers to fit zoom level
//   google.maps.event.addListener(map, 'zoom_changed', function() {
      
//       const pixelSizeAtZoom0 = 1;
//       const zoom = map.getZoom();
//       let izoom = 20 - zoom;
    
    
    
//       setTimeout( ()=>{
//         console.clear();
//         console.log(zoom,izoom);
//         console.log(mapSize)
//       }, 50)
    
    
    
//       // mapMarker.setIcon(
//       //     new google.maps.MarkerImage(
//       //         mapMarker.getIcon().url, //marker's same icon graphic
//       //         null,//size
//       //         new google.maps.Point(0, 0),
//       //         new google.maps.Point(mapSize/(izoom + 1), mapSize/(izoom + 1) ),
//       //         new google.maps.Size(mapSize, mapSize) //changes the scale
//       //     )
//       // );   
    
//   });
  
  const currPosMarker = new google.maps.Marker({
    position: { lat: 10.900016808568687, lng: 76.9028589289025 },map,
    icon: "https://cdn.glitch.global/9d67ff5c-524b-467b-aa2f-2cb422728542/currPosMarker.png?v=1661892594255",
    // position: google.maps.ControlPosition.TOP_CENTER,
  });
 
  // 10.904444839645889, 76.89907299989305
  // 10.903717134576203, 76.8992274346881
  const mapSize = 7560
  // const mapMarker = new google.maps.Marker({
  //   position: { lat: 10.903717134576203, lng: 76.8992274346881 },map,
  //     icon: {
  //       url: mapIcon,
  //       origin: new google.maps.Point(0, 0),
  //       anchor: new google.maps.Point(mapSize/2, mapSize/2),
  //     },
  // });
  
  
//   const mapImage = new google.maps.MarkerImage(
//     mapIcon,
//     new google.maps.Size(4320,4320), //size
//     new google.maps.Point(0, 0), // origin
//     new google.maps.Point(0, 2160 ), // anchor
//     new google.maps.Size(8,8) //scale
//   );
    
//   const mapMarker = new google.maps.Marker({
//     position: new google.maps.LatLng(10.90370935780691, 76.89921211104604),
//     map: map,
//     icon: mapImage //set the markers icon to the MarkerImage
//   });
  
  // setInterval(loop,1000);
}
  
  
const tree_icon_url = "https://amritatrees.sirv.com/treeicon32.png";
// const tree_icon_url = "https://cdn.glitch.global/9d67ff5c-524b-467b-aa2f-2cb422728542/treeicon.32png.png?v=1662405399801";
// const transparent = "https://cdn.glitch.global/9d67ff5c-524b-467b-aa2f-2cb422728542/transparentlayer.png?v=1664718701490";
const mapIcon = "https://cdn.glitch.global/9d67ff5c-524b-467b-aa2f-2cb422728542/amritamap.png?v=1664725171814"
window.initMap = initMap;
</script>

<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA554gL9cKaa3KqhS8biWu9p9eDCn31z0Q&callback=initMap">
</script>
  
</html>